<!DOCTYPE html>
<html>
<body>

<label for="ver">Choose EIO version:</label>
<select name="ver" id="ver">
  <option value="eio4">EIO4</option>
  <option value="eio3">EIO3</option>
</select>

<label for="start">Choose a transport to start:</label>
<select name="start" id="start">
  <option value="polling">polling</option>
  <option value="websocket">websocket</option>
  <option value="sse">sse</option>
</select>

<label for="upgrade">Choose a transport to upgrade:</label>
<select name="upgrade" id="upgrade">
  <option value="websocket">websocket</option>
  <option value="sse">sse</option>
  <option value="">none</option>
</select>

<label for="jsonp">Use jsonp:</label>
<select name="jsonp" id="jsonp">
  <option value="no">no</option>
  <option value="yes">yes</option>
</select>

<button type="button" onclick="go_eio()">Go!</button>

<script src="/eio4.js"></script>
<script>let eio4 = eio; eio = undefined;</script>
<script src="/eio3.js"></script>
<script>let eio3 = eio; eio = undefined;</script>

<script>
  let go_eio = function() {
    let ver = document.getElementById("ver").value;
    let start = document.getElementById("start").value;
    let upgrade = document.getElementById("upgrade").value;
    let jsonp = document.getElementById("jsonp").value;
    let transports = [start];
    if (upgrade != '') {
      transports = [start, upgrade];
    }

    let eio = eio4;
    if (ver == 'eio3') {
      eio = eio3;
    }

    let socket = new eio.Socket('ws://' + window.location.host + '/', {
      transports: transports,
      jsonp: jsonp == 'yes',
      forceJSONP: jsonp == 'yes',
    });

    socket.on('error', err => {
      console.log('error: '+ err);
    });

    let count = 5;
    let send = function() {
      if (count <= 0) {
        socket.close();
        return;
      }

      count--;
      socket.send('hello');
      setTimeout(send, 1000);
    }

    socket.on('open', so => {
      socket.on('message', data => {
        console.log('message: ' + data);
      });
      socket.on('close', () => {
        console.log('closed');
      });
      send();
    });
  }
</script>

</body>
</html>

